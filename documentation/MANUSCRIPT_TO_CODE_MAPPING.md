# Manuscript to Code Mapping

## Complete Traceability from Manuscript Figures to Source Code

**Manuscript**: "A multilevel trait-integration framework identifies key predictors of tomato salt tolerance"
**Journal**: Journal of Experimental Botany (JXB)
**Repository**: https://github.com/scatenag/Tomato-Salt-Tolerance-Analysis
**Zenodo DOI**: https://doi.org/10.5281/zenodo.17792340

---

## Data Source

All figures are generated from a single primary data file:

- **File**: `data/master_dataset.csv`
- **Design**: 6 genotypes × 3 salinity treatments × 4 time points × 3 replicates
- **Parameters**: 68+ biological measurements across multiple functional categories

The intermediate data files for Figures 1, 3, and 7 are derived from `master_dataset.csv` using:
- **Script**: `scripts/unify_data_sources.py`

---

## Main Figures

### Figure 1: Pathway Activity Heatmap

**Description**: Hierarchical pathway activity analysis showing 7 functional levels across genotypes and stress treatments.

**Source Script**: `scripts/figure_01_pathway_activity/generate_pathway_heatmap.py`

**Input Data**:
- Primary: `data/master_dataset.csv`
- Derived: `data/classic_pathway_activities_unified.csv` (generated by `unify_data_sources.py`)

**Key Methods**:
- Pathway activity scores calculated as fold change vs control
- Z-score normalization for heatmap visualization
- Heatmap with diverging colormap (blue-white-red)

**Output**: `figure_01_pathway_activity_heatmap.png`, `.pdf`

---

### Figure 2: Adaptive Differences (WR vs CV)

**Description**: Parameter-level adaptive differences between wild (WR) and domesticated (CV) genotypes under S1 and S2 stress treatments.

**Source Script**: `scripts/figure_02_adaptive_differences/generate_figure_02.py`

**Input Data**: `data/master_dataset.csv`

**Key Methods**:
- Activity score calculation: (Stress - Control) / Control
- Welch's t-test for statistical significance
- Heatmap with parameter grouping by biological level

**Output**: `figure_02_adaptive_differences.png`, `.pdf`

---

### Figure 3: Multilevel Correlation Network

**Description**: Integrated multilevel biological network showing cross-domain trait relationships.

**Source Script**: `scripts/figure_03_network/generate_network_PUBLICATION_FINAL.R`

**Input Data**:
- Nodes: `scripts/figure_03_network/nodes_unified.csv`
- Edges: `scripts/figure_03_network/edges_unified.csv`
- Both generated from `master_dataset.csv` via `unify_data_sources.py`

**Key Methods**:
- Spearman correlation matrix calculation
- Correlation thresholds: positive ≥0.35, negative ≤-0.30
- Circular layout with hierarchical grouping by biological level
- igraph network visualization in R

**Output**: `figure_03_multilevel_network.png`, `.pdf`

---

### Figure 4: Phenological GDD Timing

**Description**: Two-panel figure showing (a) GDD heatmap by phenological phase and (b) phenological delay scatter plot.

**Source Script**: `scripts/figure_04_phenological_timing/generate_figure_04.py`

**Input Data**: `data/master_dataset.csv`

**Key Methods**:
- GDD (Growing Degree Days) calculation from cumulative thermal time
- Phenological phases: Vegetative, Flowering, Fruit set, Fruit ripening
- Delay calculation relative to control treatment

**Output**: `figure_04_phenological_timing.png`, `.pdf`

---

### Figure 5: Temporal Dynamics

**Description**: 12-panel figure showing temporal evolution of 4 phenological metrics (Main shoot height, Flowering, Fruit set, Fruit ripening) across 3 treatments.

**Source Script**: `scripts/figure_05_temporal_dynamics/generate_figure_05.py`

**Input Data**: `data/master_dataset.csv`

**Key Methods**:
- Time series plotting across DAT (Days After Transplanting)
- Welch's t-test with Bonferroni correction for WR vs CV comparisons
- Mean ± SE visualization with significance asterisks

**Output**: `figure_05_temporal_dynamics.png`, `.pdf`

---

### Figure 6: Variety Ranking

**Description**: Two-panel figure showing (a) overall salt tolerance ranking and (b) category contribution breakdown.

**Source Script**: `scripts/figure_06_variety_ranking/generate_figure_06.py`

**Input Data**: `data/master_dataset.csv`

**Key Methods**:
- Weighted tolerance scoring system:
  - Performance Maintenance (55%): productivity metrics
  - Physiological Stability (25%): Fv/Fm, chlorophyll, RWC, stomatal conductance
  - Stress Marker Response (20%): electrolytic leakage, Na/K ratio, ABA, osmolytes
- Horizontal bar charts with stacked category visualization

**Output**: `figure_06_variety_ranking.png`, `.pdf`

---

### Figure 7: Parameter Responsiveness Heatmap

**Description**: Two-panel heatmap comparing parameter responsiveness between WR10 (best wild accession) and CV, showing F-statistic, effect size (η²), and % change scores.

**Source Script**: `scripts/figure_07_responsiveness/generate_figure_07.py`

**Input Data**:
- Primary: `data/master_dataset.csv`
- Derived: `data/parameter_ranking_unified.csv` (generated by `unify_data_sources.py`)

**Key Methods**:
- ANOVA F-statistic calculation
- Effect size (η²) calculation
- Percent change from Control to S2
- Normalization to 0-100 scale

**Output**: `figure_07_parameter_responsiveness.png`, `.pdf`

---

### Figure 8: Regression Comparison

**Description**: Three-panel figure showing dose-response curves for key parameters (Main shoot height, Stomatal conductance, Electrolytic leakage) comparing WR10 vs CV.

**Source Script**: `scripts/figure_08_regression_comparison/generate_figure_08.py`

**Input Data**: `data/master_dataset.csv`

**Key Methods**:
- Linear regression for Performance and Physiological parameters
- Exponential regression for Stress Marker parameters
- R² calculation for model fit
- 95% confidence interval visualization

**Output**: `figure_08_regression_comparison.png`, `.pdf`

---

## Supporting Files

### Parameter Mappings

**File**: `scripts/parameter_mapping.py`

Contains centralized definitions for:
- `PARAMETER_LEVELS`: Maps parameters to 7 biological levels
- `PARAMETER_CATEGORIES`: Maps parameters to 3 ranking categories
- `LEVEL_TRANSLATIONS`: English names for biological levels

All figure scripts import from this file to ensure consistency.

### Data Preprocessing

**File**: `scripts/unify_data_sources.py`

Generates all intermediate CSV files from `master_dataset.csv`:
- `data/classic_pathway_activities_unified.csv` (Figure 1)
- `data/parameter_ranking_unified.csv` (Figure 7)
- `scripts/figure_03_network/nodes_unified.csv` (Figure 3)
- `scripts/figure_03_network/edges_unified.csv` (Figure 3)

---

## Jupyter Notebook

**File**: `notebooks/MANUSCRIPT_FIGURES.ipynb`

Interactive notebook that generates all 8 manuscript figures. Ideal for:
- Step-by-step reproduction
- Interactive exploration
- Verification of results

---

## Reproduction Workflow

### Quick Reproduction (Recommended)

```bash
# 1. Clone repository
git clone https://github.com/scatenag/Tomato-Salt-Tolerance-Analysis.git
cd Tomato-Salt-Tolerance-Analysis

# 2. Install dependencies
pip install -r requirements.txt

# 3. Generate intermediate data
python scripts/unify_data_sources.py

# 4. Generate all figures
python scripts/figure_01_pathway_activity/generate_pathway_heatmap.py
python scripts/figure_02_adaptive_differences/generate_figure_02.py
Rscript scripts/figure_03_network/generate_network_PUBLICATION_FINAL.R
python scripts/figure_04_phenological_timing/generate_figure_04.py
python scripts/figure_05_temporal_dynamics/generate_figure_05.py
python scripts/figure_06_variety_ranking/generate_figure_06.py
python scripts/figure_07_responsiveness/generate_figure_07.py
python scripts/figure_08_regression_comparison/generate_figure_08.py
```

### Interactive Reproduction

```bash
jupyter notebook notebooks/MANUSCRIPT_FIGURES.ipynb
```

---

## Dependencies

### Python Packages
- pandas >= 1.3.0
- numpy >= 1.21.0
- matplotlib >= 3.4.0
- seaborn >= 0.11.0
- scipy >= 1.7.0

### R Packages (Figure 3 only)
- igraph
- RColorBrewer

See `requirements.txt` for complete Python dependency list.

---

## Notes on Reproducibility

1. **Single data source**: All figures derive from `data/master_dataset.csv` ensuring consistency.

2. **Intermediate files**: Running `unify_data_sources.py` regenerates all derived CSV files.

3. **Figure 3 (R)**: Requires R with igraph package. Can be skipped if only Python figures are needed.

4. **Font requirements**: Scripts use Arial font. Falls back to system default if unavailable.

5. **Output formats**: All figures are saved as PNG (300 DPI) and PDF for publication.

---

**Document Updated**: January 2026
**Purpose**: Manuscript reproducibility for JXB publication
